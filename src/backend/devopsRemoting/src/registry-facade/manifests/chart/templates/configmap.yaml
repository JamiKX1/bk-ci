#wsproxy configmap
kind: ConfigMap
apiVersion: v1
metadata:
  name: {{ .Release.Name }}-config
  namespace: {{ .Release.Namespace }}
  labels:
    app.kubernetes.io/instance: {{ .Release.Name }}
    app.kubernetes.io/component: {{ .Release.Name }}
    app.kubernetes.io/name: {{ .Release.Name }}
data:
  run.json: |-
    {
      {{- if .Values.registry.dockerAuth }}
      "dockerAuth": "/data/workspace/registry-facade/pull-secret/pull-secret.json",
      {{- end }}
      "registry": {
        "port": 9000,
        "prefix": "remote",
        {{- if .Values.registry.staticLayers }}
        "staticLayer": {{ toJson .Values.registry.staticLayers }},
        {{- end }}
        "store": "/data/landun/workspace/cache",
        "requireAuth": false,
        "remoteSpecProvider": [
          {
            "addr": "{{.Values.registry.remoteSpecProvider.addr}}"
          }
        ],
        "tls": {
          "crt": "/data/workspace/registry-facade/tls/https.pem",
          "key": "/data/workspace/registry-facade/tls/https.key"
        }
      },
      "readinessProbeAddr": ":8000"
    }
